const keyboard = [
    {
        id : 0,
        keyRu : 'ё',
        keyEn : '~',
        code : 'Backquote',
        classButton : ['button']
    },
    {
        id : 1,
        keyRu : '1',
        keyEn : '1',
        code : 'Digit1',
        classButton : ['button']
    },
    {
        id : 2,
        keyRu : '2',
        keyEn : '2',
        code : 'Digit2',
        classButton : ['button']
    },
    {
        id : 3,
        keyRu : '3',
        keyEn : '3',
        code : 'Digit3',
        classButton : ['button']
    },
    {
        id : 4,
        keyRu : '4',
        keyEn : '4',
        code : 'Digit4',
        classButton : ['button']
    },
    {
        id : 5,
        keyRu : '5',
        keyEn : '5',
        code : 'Digit5',
        classButton : ['button']
    },
    {
        id : 6,
        keyRu : '6',
        keyEn : '6',
        code : 'Digit6',
        classButton : ['button']
    },
    {
        id : 7,
        keyRu : '7',
        keyEn : '7',
        code : 'Digit7',
        classButton : ['button']
    },
    {
        id : 8,
        keyRu : '8',
        keyEn : '8',
        code : 'Digit8',
        classButton : ['button']
    },
    {
        id : 9,
        keyRu : '9',
        keyEn : '9',
        code : 'Digit9',
        classButton : ['button']
    },
    {
        id : 10,
        keyRu : '0',
        keyEn : '0',
        code : 'Digit0',
        classButton : ['button']
    },
    {
        id : 11,
        keyRu : '-',
        keyEn : '-',
        keyShift : '_',
        code : 'Minus',
        classButton : ['button']
    },
    {
        id : 12,
        keyRu : '=',
        keyEn : '=',
        keyShift : '+',
        code : 'Equal',
        classButton : ['button']
    },
    {
        id : 13,
        keyRu : 'Backspace',
        keyEn : 'Backspace',
        code : 'Backspace',
        classButton : ['button','button_backspace']
    },
    {
        id : 14,
        keyRu : 'Tab',
        keyEn : 'Tab',
        code : 'Tab',
        classButton : ['button','button_tab']
    },
    {
        id : 15,
        keyRu : 'й',
        keyEn : 'q',
        code : 'KeyQ',
        classButton : ['button']
    },
    {
        id : 16,
        keyRu : 'ц',
        keyEn : 'w',
        code : 'KeyW',
        classButton : ['button']
    },
    {
        id : 17,
        keyRu : 'у',
        keyEn : 'e',
        code : 'KeyE',
        classButton : ['button']
    },
    {
        id : 18,
        keyRu : 'к',
        keyEn : 'r',
        code : 'KeyR',
        classButton : ['button']
    },
    {
        id : 19,
        keyRu : 'е',
        keyEn : 't',
        code : 'KeyT',
        classButton : ['button']
    },
    {
        id : 20,
        keyRu : 'н',
        keyEn : 'y',
        code : 'KeyY',
        classButton : ['button']
    },
    {
        id : 21,
        keyRu : 'г',
        keyEn : 'u',
        code : 'KeyU',
        classButton : ['button']
    },
    {
        id : 22,
        keyRu : 'ш',
        keyEn : 'i',
        code : 'KeyI',
        classButton :['button']
    },
    {
        id : 23,
        keyRu : 'щ',
        keyEn : 'o',
        code : 'KeyO',
        classButton : ['button']
    },
    {
        id : 24,
        keyRu : 'з',
        keyEn : 'p',
        code : 'KeyP',
        classButton : ['button']
    },
    {
        id : 25,
        keyRu : 'х',
        keyEn : '[',
        code : 'BracketLeft',
        classButton : ['button']
    },
    {
        id : 26,
        keyRu : 'ъ',
        keyEn : ']',
        code : 'BracketRight',
        classButton : ['button']
    },
    {
        id : 27,
        keyRu : '\\',
        keyEn : '\\',
        code : 'Backslash',
        classButton : ['button']
    },
    {
        id : 28,
        keyRu : 'CapsLock',
        keyEn : 'CapsLock',
        code : 'CapsLock',
        classButton : ['button','button_caps_lock']
    },
    {
        id : 29,
        keyRu : 'ф',
        keyEn : 'a',
        code : 'KeyA',
        classButton : ['button']
    },
    {
        id : 31,
        keyRu : 'ы',
        keyEn : 's',
        code : 'KeyS',
        classButton : ['button']
    },
    {
        id : 32,
        keyRu : 'в',
        keyEn : 'd',
        code : 'KeyD',
        classButton : ['button']
    },
    {
        id : 33,
        keyRu : 'а',
        keyEn : 'f',
        code : 'KeyF',
        classButton : ['button']
    },
    {
        id : 34,
        keyRu : 'п',
        keyEn : 'g',
        code : 'KeyG',
        classButton : ['button']
    },
    {
        id : 35,
        keyRu : 'р',
        keyEn : 'h',
        code : 'KeyH',
        classButton : ['button']
    },
    {
        id : 36,
        keyRu : 'о',
        keyEn : 'j',
        code : 'KeyJ',
        classButton : ['button']
    },
    {
        id : 37,
        keyRu : 'л',
        keyEn : 'k',
        code : 'KeyK',
        classButton : ['button']
    },
    {
        id : 38,
        keyRu : 'д',
        keyEn : 'l',
        code : 'KeyL',
        classButton : ['button']
    },
    {
        id : 39,
        keyRu : 'ж',
        keyEn : ';',
        code : 'Semicolon',
        classButton : ['button']
    },
    {
        id : 40,
        keyRu : 'э',
        keyEn : '\'',
        code : 'Quote',
        classButton : ['button']
    },
    {
        id : 41,
        keyRu : 'Enter',
        keyEn : 'Enter',
        code : 'Enter',
        classButton : ['button','button_enter']
    },
    {
        id : 42,
        keyRu : 'Shift',
        keyEn : 'Shift',
        code : 'ShiftLeft',
        classButton : ['button','button_shift']
    },
    {
        id : 43,
        keyRu : '\\',
        keyEn : '\\',
        code : 'Backslash',
        classButton : ['button']
    },
    {
        id : 44,
        keyRu : 'я',
        keyEn : 'z',
        code : 'KeyZ',
        classButton : ['button']
    },
    {
        id : 45,
        keyRu : 'ч',
        keyEn : 'x',
        code : 'KeyX',
        classButton : ['button']
    },
    {
        id : 46,
        keyRu : 'с',
        keyEn : 'c',
        code : 'KeyC',
        classButton : ['button']
    },
    {
        id : 47,
        keyRu : 'м',
        keyEn : 'v',
        code : 'KeyV',
        classButton : ['button']
    },
    {
        id : 48,
        keyRu : 'и',
        keyEn : 'b',
        code : 'KeyB',
        classButton : ['button']
    },
    {
        id : 49,
        keyRu : 'т',
        keyEn : 'n',
        code : 'KeyN',
        classButton : ['button']
    },
    {
        id : 50,
        keyRu : 'ь',
        keyEn : 'm',
        code : 'KeyM',
        classButton : ['button']
    },
    {
        id : 51,
        keyRu : 'б',
        keyEn : ',',
        code : 'Comma',
        classButton : ['button']
    },
    {
        id : 52,
        keyRu : 'ю',
        keyEn : '.',
        code : 'Period',
        classButton : ['button']
    },
    {
        id : 53,
        keyRu : '.',
        keyEn : '/',
        code : 'Slash',
        classButton : ['button']
    },
    {
        id : 54,
        keyRu : '↑',
        keyEn : '↑',
        code : 'ArrowUp',
        classButton : ['button']
    },
    {
        id : 55,
        keyRu : 'Shift',
        keyEn : 'Shift',
        code : 'ShiftRight',
        classButton : ['button']
    },
    {
        id : 56,
        keyRu : 'Ctrl',
        keyEn : 'Ctrl',
        code : 'ControlLeft',
        classButton : ['button','button_ctrl']
    },
    {
        id : 57,
        keyRu : 'Win',
        keyEn : 'Win',
        code : 'Meta',
        classButton : ['button']
    },
    {
        id : 58,
        keyRu : 'Alt',
        keyEn : 'Alt',
        code : 'AltLeft',
        classButton : ['button']
    },
    {
        id : 59,
        keyRu : ' ',
        keyEn : ' ',
        code : 'Space',
        classButton : ['button','button_space']
    },
    {
        id : 60,
        keyRu : 'Alt',
        keyEn : 'Alt',
        code : 'AltRight',
        classButton : ['button']
    },
    {
        id : 61,
        keyRu : 'Ctrl',
        keyEn : 'Ctrl',
        code : 'ControlRight',
        classButton : ['button']
    },
    {
        id : 62,
        keyRu : '←',
        keyEn : '←',
        code : 'ArrowLeft',
        classButton : ['button']
    },
    {
        id : 63,
        keyRu : '↓',
        keyEn : '↓',
        code : 'ArrowDown',
        classButton : ['button']
    },
    {
        id : 64,
        keyRu : '→',
        keyEn : '→',
        code : 'ArrowRight',
        classButton : ['button']
    }

]


let CL = false;
let SH = false;
//const codes =[];
let language = localStorage.getItem('lang')
window.onload = () => {
    if(language){
        if(language === 'En'){
            loadBodyEn();
        } else if (language === 'Ru') {
            loadBodyRu();
        }
    } else {
        loadBodyEn();
        language = 'En'
    }
    // document.querySelectorAll('.button').forEach(el => codes.push(el.dataset.code));
    // console.log(codes);
    click();
    keyBoard();
    //keyboardUp();
}


const loadBodyRu= () =>{
    document.body.innerHTML = `<section class="overlay"></section>`;
    document.querySelector('.overlay').innerHTML = `<textarea name="" class="input" cols="30" rows="10"></textarea>
    <div class="keyboard"></div>`;
    keyboard.forEach(el => {
        let classButton = '';
        el.classButton.forEach(el => {
            classButton += ` ${el}`;
        } )
        document.querySelector('.keyboard').innerHTML += `<div class='${classButton}' data-code=${el.code} >${el.keyRu}</div>`
    })

}


const loadBodyEn= () =>{
    document.body.innerHTML = `<section class="overlay"></section>`;
    document.querySelector('.overlay').innerHTML = `<textarea name="" class="input" cols="30" rows="10"></textarea>
    <div class="keyboard"></div>`;
    keyboard.forEach(el => {
        let classButton = '';
        el.classButton.forEach(el => {
            classButton += ` ${el}`;
        } )
        document.querySelector('.keyboard').innerHTML += `<div class='${classButton}' data-code=${el.code} >${el.keyEn}</div>`
    })

}




const click = () => {
    let pressedMouse = new Set();
    document.querySelectorAll('.button').forEach(el => {
        el.addEventListener('mousedown', (event) =>{
            pressedMouse.add(event.target.dataset.code);
            // console.log(pressedMouse);
            // if (CL){
            //     pressedMouse.delete(event.target.dataset.code);
            //     setTimeout(() => {
            //         event.target.id = '';
            //     },300);
            //     CL = false;
            // } else {
            //     if (event.target.dataset.code === 'CapsLock'){
            //         CL = true;
            //     }
            // }
        //     for (let code of pressedMouse) {
        //         if (code === 'CapsLock'){
        //             if(event.target.id === 'button_active'){
        //                 CL = false;
        //                 setTimeout(() => {
        //                     el.id = '';
        //                 },300);
        //                 console.log(CL)
        //             } else {
        //                 CL = true;
        //                 // el.id = 'button_active';
        //                 console.log(CL)
        //             }
        //         }   
        //             if(event.target.dataset.code === code){
        //                 el.id = 'button_active';
        //             }
        //         buttonDown(event.target)
        //     }  
            
        //     //buttonDown(event.target)    
        //    //buttonDown(event.target);
        })
        el.addEventListener('mouseup', (event) => {
            document.querySelectorAll('.button').forEach(el => {
                if(el.dataset.code === event.target.dataset.code){
                    if (CL){
                        if (event.code === 'CapsLock'){
                            pressedMouse.delete(event.target.dataset.code);
                            setTimeout(() => {
                                el.id = '';
                            },300);
                            CL = false;
                        } else {
                            pressedMouse.delete(event.target.dataset.code);
                            setTimeout(() => {
                                el.id = '';
                            },300);
                        }
                    } else {
                        if (event.target.dataset.code === 'CapsLock'){
                            CL = true;
                        } else {
                            pressedMouse.delete(event.code);
                            setTimeout(() => {
                                el.id = '';
                            },300);
                        }
                    }
                }
                // if(el.dataset.code === event.target.dataset.code && el.dataset.code != 'CapsLock'){
                //     setTimeout(() => {
                //         el.id = '';
                //     },300);
                //     pressedMouse.delete(event.target.dataset.code);
                // }
            })
            console.log(pressedMouse)
        });
        
    })
    
}

  
    
const keyBoard = () => {
    let pressed = new Set();
    document.addEventListener('keydown', (event) =>{
        
        pressed.add(event.code);
        //console.log(pressed);
        // if (CL){
        //     pressed.delete(event.code);
        //     CL = false;
        // } else {
        //     if (event.code === 'CapsLock'){
        //         CL = true;
        //     }
        // }
        //console.log(pressed);
        //console.log(CL);
        event.preventDefault();

        //     document.querySelectorAll('.button').forEach(el => {
        //         if (code === 'CapsLock'){
        //             if(el.id === 'button_active'){
        //                 CL = false;
        //                 setTimeout(() => {
        //                     el.id = '';
        //                 },300);
        //                 console.log(CL)
        //             } else {
        //                 CL = true;
        //                 // el.id = 'button_active';
        //                 console.log(CL)
        //             }
        //         }   
        //         if(el.dataset.code === code){
        //            // document.querySelector('.input').value += el.innerText;
        //             el.id = 'button_active';
        //         }
                
        //     })
           
        // } 
        // buttonDown(event)   
    })
    document.addEventListener('keyup', (event) => {
        document.querySelectorAll('.button').forEach(el => {
            if(el.dataset.code === event.code){
                if (CL){
                    if (event.code === 'CapsLock'){
                        pressed.delete(event.code);
                        setTimeout(() => {
                            el.id = '';
                        },300);
                        CL = false;
                    } else {
                        pressed.delete(event.code);
                        setTimeout(() => {
                            el.id = '';
                        },300);
                    }
                } else {
                    if (event.code === 'CapsLock'){
                        CL = true;
                    } else {
                        pressed.delete(event.code);
                        setTimeout(() => {
                            el.id = '';
                        },300);
                    }
                }
            }
        })
        console.log(CL);
        console.log(pressed);
    });
    
}

// const keyboardUp = () => {
//     document.addEventListener('keyup', () =>{
//         //console.log(event);
//         document.querySelectorAll('.button').forEach(el => {
//             if(el.innerHTML === 'Shift'){
//                 // console.log('dlhehbvsdjvbh');
//                 //SH = false;
//             }
//             } )
            
//         }) 
// }
    







const buttonDown = (el, arr ) => {
     
     if (el.dataset.code.slice(0,-1) === 'Key'){
        if(CL || SH){
            //console.log(CL)
            document.querySelector('.input').value += el.innerText.toUpperCase();
           // el.id = 'button_active';
            
        } else {
            document.querySelector('.input').value += el.innerText;
           // el.id = 'button_active';
        }   
    }

    //  else if (el.innerHTML === 'Shift'){
    //     SH = true;
    //    // el.id = 'button_active';
    // } else{
    //     // SH = false;
    // }
    // //  } else {
    //     document.querySelector('.input').value += el.innerText;
    //   //  el.id = 'button_active';
        
    //  }
    // switch(el.dataset.code){
    //     case 'CapsLock':
            
    //         break;
    //     case ('Key' + el.innerText.toUpperCase()):
            
    //         break;
    //     default :
            
    //         break;
    // }
}



    // const clickBack = () => {
    //     document.querySelectorAll('.button').addEventListener('click', (event) =>{
    //         if(event.target.classList.contains('button_backspace')){
    //             //console.log('hello')
    //         }
            
    //     } )
    // }

    //if(language === 'En'){
        //     language = 'Ru';
        //     localStorage.setItem('lang', language)
        // } else if (language === 'Ru') {
        //     language = 'En';
        //     localStorage.setItem('lang', language)
        // } 